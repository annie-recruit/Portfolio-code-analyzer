<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬íŠ¸í´ë¦¬ì˜¤ ì½”ë“œ í’ˆì§ˆ ê²€ì¦ê¸°</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .input-section {
            margin-bottom: 30px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        .file-upload:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }
        .file-upload input {
            display: none;
        }
        .file-upload-label {
            display: block;
            font-size: 18px;
            color: #667eea;
            margin-bottom: 10px;
        }
        .file-info {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        .analyze-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .results {
            display: none;
            margin-top: 30px;
        }
        .results.active {
            display: block;
        }
        .result-card {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .score-display .score {
            font-size: 72px;
            font-weight: bold;
            margin: 10px 0;
        }
        .score-display .grade {
            font-size: 48px;
            opacity: 0.9;
        }
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .copyright {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ì½”ë“œ í’ˆì§ˆ ê²€ì¦ê¸°</h1>
            <p>í…Œí¬ ë¦¬í¬ë£¨í„°ë¥¼ ìœ„í•œ ì½”ë“œ í’ˆì§ˆ ë¶„ì„ ë„êµ¬</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('text')">í…ìŠ¤íŠ¸ ì…ë ¥</button>
                    <button class="tab" onclick="switchTab('file')">íŒŒì¼ ì—…ë¡œë“œ</button>
                </div>
                
                <div id="text-tab" class="tab-content active">
                    <textarea id="code-input" placeholder="ë¶„ì„í•  ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;def hello_world():&#10;    print('Hello, World!')&#10;    return True"></textarea>
                </div>
                
                <div id="file-tab" class="tab-content">
                    <div class="file-upload" onclick="document.getElementById('file-input').click()">
                        <input type="file" id="file-input" accept=".py,.js,.ts,.java,.cpp,.c,.cs,.go,.rs,.rb,.php" onchange="handleFileSelect(event)">
                        <div class="file-upload-label">ğŸ“ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</div>
                        <div class="file-info" id="file-info">ë˜ëŠ” íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    </div>
                    <textarea id="file-content" style="display: none; margin-top: 20px;"></textarea>
                </div>
                
                <button class="analyze-btn" id="analyze-btn" onclick="analyzeCode()">ë¶„ì„ ì‹œì‘</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ì½”ë“œë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
            </div>
            
            <div class="results" id="results"></div>
        </div>
        
        <div class="copyright">
            Copyright (c) 2025 Gaon. All rights reserved.<br>
            ì›ë³¸ ì¶œì²˜: <a href="https://github.com/annie-recruit/Portfolio-code-analyzer" style="color: #667eea;">https://github.com/annie-recruit/Portfolio-code-analyzer</a>
        </div>
    </div>

    <script>
        let pyodide = null;
        let currentCode = '';

        // Pyodide ì´ˆê¸°í™”
        async function initPyodide() {
            if (pyodide) return;
            
            console.log('Pyodide ì´ˆê¸°í™” ì¤‘...');
            pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
            });
            
            // í•„ìš”í•œ Python ëª¨ë“ˆ ì„¤ì¹˜
            await pyodide.loadPackage(['micropip']);
            const micropip = pyodide.pyimport('micropip');
            
            console.log('Pyodide ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // íƒ­ ì „í™˜
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            if (tab === 'text') {
                document.querySelector('.tab').classList.add('active');
                document.getElementById('text-tab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('file-tab').classList.add('active');
            }
        }

        // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('file-info').textContent = `ì„ íƒëœ íŒŒì¼: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentCode = e.target.result;
                document.getElementById('file-content').value = currentCode;
            };
            reader.readAsText(file);
        }

        // ì½”ë“œ ë¶„ì„
        async function analyzeCode() {
            const codeInput = document.getElementById('code-input');
            const fileContent = document.getElementById('file-content');
            
            // ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
            if (codeInput.value.trim()) {
                currentCode = codeInput.value;
            } else if (fileContent.value.trim()) {
                currentCode = fileContent.value;
            } else {
                alert('ì½”ë“œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!currentCode.trim()) {
                alert('ì½”ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('results').innerHTML = '';
            
            try {
                // Pyodide ì´ˆê¸°í™” (ì²˜ìŒ í•œ ë²ˆë§Œ)
                await initPyodide();
                
                // Python ë¶„ì„ ì½”ë“œ ì‹¤í–‰
                const analysisCode = `
import ast
import re
from collections import defaultdict

def analyze_code(code_content):
    results = {
        'files_analyzed': 1,
        'total_lines': len(code_content.split('\\n')),
        'languages': {},
        'complexity': {'avg': 0, 'max': 0, 'high_complexity_files': []},
        'readability': {'score': 0, 'issues': []},
        'structure': {'score': 0, 'issues': []},
        'issues': [],
        'metrics': {}
    }
    
    lines = code_content.split('\\n')
    
    # ì–¸ì–´ ê°ì§€
    if any(keyword in code_content for keyword in ['def ', 'import ', 'class ', 'print(']):
        results['languages']['Python'] = 1
        lang = 'Python'
    elif any(keyword in code_content for keyword in ['function ', 'const ', 'let ', '=>']):
        results['languages']['JavaScript'] = 1
        lang = 'JavaScript'
    elif 'public class' in code_content or 'public static' in code_content:
        results['languages']['Java'] = 1
        lang = 'Java'
    else:
        results['languages']['Unknown'] = 1
        lang = 'Unknown'
    
    # Python ì½”ë“œ ë¶„ì„
    if lang == 'Python':
        try:
            tree = ast.parse(code_content)
            complexity = 1
            
            for node in ast.walk(tree):
                if isinstance(node, (ast.If, ast.While, ast.For, ast.Try, ast.With)):
                    complexity += 1
                elif isinstance(node, ast.BoolOp):
                    complexity += len(node.values) - 1
            
            results['complexity']['avg'] = complexity
            results['complexity']['max'] = complexity
            
            if complexity > 10:
                results['complexity']['high_complexity_files'].append({
                    'file': 'uploaded_code.py',
                    'complexity': complexity
                })
            
            # í•¨ìˆ˜ ê¸¸ì´ ì²´í¬
            for node in ast.walk(tree):
                if isinstance(node, ast.FunctionDef):
                    if node.end_lineno and node.lineno:
                        func_length = node.end_lineno - node.lineno
                        if func_length > 50:
                            results['structure']['issues'].append({
                                'file': 'uploaded_code.py',
                                'type': 'long_function',
                                'message': f'í•¨ìˆ˜ "{node.name}"ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤ ({func_length}ì¤„)',
                                'severity': 'medium'
                            })
        except SyntaxError as e:
            results['issues'].append({
                'file': 'uploaded_code.py',
                'type': 'syntax_error',
                'message': f'êµ¬ë¬¸ ì˜¤ë¥˜: {str(e)}',
                'severity': 'high'
            })
    
    # ê°€ë…ì„± ì²´í¬
    comment_lines = sum(1 for line in lines if line.strip().startswith('#') or '//' in line or '/*' in line)
    comment_ratio = comment_lines / len(lines) if lines else 0
    
    if comment_ratio < 0.1 and len(lines) > 50:
        results['readability']['issues'].append({
            'file': 'uploaded_code',
            'type': 'low_comments',
            'message': 'ì£¼ì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤',
            'severity': 'medium'
        })
    
    long_lines = [i+1 for i, line in enumerate(lines) if len(line) > 120]
    if long_lines:
        results['readability']['issues'].append({
            'file': 'uploaded_code',
            'type': 'long_lines',
            'message': f'120ìë¥¼ ì´ˆê³¼í•˜ëŠ” ê¸´ ì¤„ì´ {len(long_lines)}ê°œ ìˆìŠµë‹ˆë‹¤',
            'severity': 'low'
        })
    
    # ì¢…í•© ì ìˆ˜ ê³„ì‚°
    score = 100
    if results['complexity']['avg'] > 10:
        score -= 20
    elif results['complexity']['avg'] > 5:
        score -= 10
    
    high_severity = sum(1 for issue in results['issues'] if issue.get('severity') == 'high')
    medium_severity = sum(1 for issue in results['issues'] if issue.get('severity') == 'medium')
    
    score -= high_severity * 5
    score -= medium_severity * 2
    score -= len(results['readability']['issues']) * 1
    score -= len(results['structure']['issues']) * 2
    
    score = max(0, min(100, score))
    results['overall_score'] = round(score, 1)
    
    if score >= 90:
        results['grade'] = 'A'
    elif score >= 80:
        results['grade'] = 'B'
    elif score >= 70:
        results['grade'] = 'C'
    elif score >= 60:
        results['grade'] = 'D'
    else:
        results['grade'] = 'F'
    
    return results

result = analyze_code(r'''${currentCode.replace(/'/g, "\\'")}''')
import json
json.dumps(result)
`;
                
                const resultJson = pyodide.runPython(analysisCode);
                const result = JSON.parse(resultJson);
                
                // ê²°ê³¼ í‘œì‹œ
                displayResults(result);
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        <strong>ì˜¤ë¥˜ ë°œìƒ:</strong><br>
                        ${error.message}<br>
                        <small>ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</small>
                    </div>
                `;
                document.getElementById('results').classList.add('active');
            } finally {
                document.getElementById('analyze-btn').disabled = false;
                document.getElementById('loading').classList.remove('active');
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(result) {
            const allIssues = [
                ...result.issues,
                ...result.readability.issues,
                ...result.structure.issues
            ];
            
            const highCount = allIssues.filter(i => i.severity === 'high').length;
            const mediumCount = allIssues.filter(i => i.severity === 'medium').length;
            const lowCount = allIssues.filter(i => i.severity === 'low').length;
            
            let languagesHtml = '';
            for (const [lang, count] of Object.entries(result.languages)) {
                languagesHtml += `<span style="background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; margin: 5px; display: inline-block;">${lang}</span>`;
            }
            
            let issuesHtml = '';
            if (allIssues.length === 0) {
                issuesHtml = '<p style="color: green;">âœ… ë°œê²¬ëœ ì´ìŠˆê°€ ì—†ìŠµë‹ˆë‹¤!</p>';
            } else {
                allIssues.forEach(issue => {
                    const severityColor = issue.severity === 'high' ? '#e74c3c' : 
                                        issue.severity === 'medium' ? '#f39c12' : '#3498db';
                    issuesHtml += `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid ${severityColor}; border-radius: 5px;">
                            <strong style="color: ${severityColor};">[${issue.severity.toUpperCase()}]</strong> ${issue.message}
                        </div>
                    `;
                });
            }
            
            const recommendations = [];
            if (result.overall_score < 70) {
                recommendations.push('ì½”ë“œ í’ˆì§ˆ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤');
            }
            if (result.complexity.avg > 10) {
                recommendations.push('ì½”ë“œ ë³µì¡ë„ë¥¼ ë‚®ì¶”ì„¸ìš”');
            }
            if (highCount > 0) {
                recommendations.push(`ì‹¬ê°í•œ ì´ìŠˆ ${highCount}ê°œë¥¼ ìš°ì„  í•´ê²°í•˜ì„¸ìš”`);
            }
            if (recommendations.length === 0) {
                recommendations.push('ì „ë°˜ì ìœ¼ë¡œ ì–‘í˜¸í•œ ì½”ë“œ í’ˆì§ˆì…ë‹ˆë‹¤');
            }
            
            const html = `
                <div class="score-display">
                    <div class="score">${result.overall_score}ì </div>
                    <div class="grade">ë“±ê¸‰: ${result.grade}</div>
                </div>
                
                <div class="result-card">
                    <h3>ğŸ“Š ë¶„ì„ ìš”ì•½</h3>
                    <p><strong>ë¶„ì„ëœ íŒŒì¼:</strong> ${result.files_analyzed}ê°œ</p>
                    <p><strong>ì´ ì½”ë“œ ë¼ì¸:</strong> ${result.total_lines.toLocaleString()}ì¤„</p>
                    <p><strong>í‰ê·  ë³µì¡ë„:</strong> ${result.complexity.avg.toFixed(1)}</p>
                    <div style="margin-top: 15px;">
                        <strong>ì‚¬ìš©ëœ ì–¸ì–´:</strong><br>
                        ${languagesHtml}
                    </div>
                </div>
                
                <div class="result-card">
                    <h3>âš ï¸ ë°œê²¬ëœ ì´ìŠˆ</h3>
                    <p><strong>ì‹¬ê°:</strong> ${highCount}ê°œ | <strong>ì¤‘ê°„:</strong> ${mediumCount}ê°œ | <strong>ë‚®ìŒ:</strong> ${lowCount}ê°œ</p>
                    ${issuesHtml}
                </div>
                
                <div class="result-card">
                    <h3>ğŸ’¡ ê°œì„  ê¶Œì¥ ì‚¬í•­</h3>
                    <ul>
                        ${recommendations.map(r => `<li>${r}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
            document.getElementById('results').classList.add('active');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Pyodide ì´ˆê¸°í™” ì‹œì‘
        window.addEventListener('load', () => {
            initPyodide();
        });
    </script>
</body>
</html>


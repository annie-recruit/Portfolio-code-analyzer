<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬íŠ¸í´ë¦¬ì˜¤ ì½”ë“œ í’ˆì§ˆ ê²€ì¦ê¸°</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .input-section {
            margin-bottom: 30px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        .file-upload:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }
        .file-upload input {
            display: none;
        }
        .file-upload-label {
            display: block;
            font-size: 18px;
            color: #667eea;
            margin-bottom: 10px;
        }
        .file-info {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        .analyze-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .results {
            display: none;
            margin-top: 30px;
        }
        .results.active {
            display: block;
        }
        .result-card {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .score-display .score {
            font-size: 72px;
            font-weight: bold;
            margin: 10px 0;
        }
        .score-display .grade {
            font-size: 48px;
            opacity: 0.9;
        }
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .copyright {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ì½”ë“œ í’ˆì§ˆ ê²€ì¦ê¸°</h1>
            <p>í…Œí¬ ë¦¬í¬ë£¨í„°ë¥¼ ìœ„í•œ ì½”ë“œ í’ˆì§ˆ ë¶„ì„ ë„êµ¬</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('github')">GitHub ì €ì¥ì†Œ</button>
                    <button class="tab" onclick="switchTab('text')">í…ìŠ¤íŠ¸ ì…ë ¥</button>
                    <button class="tab" onclick="switchTab('file')">íŒŒì¼ ì—…ë¡œë“œ</button>
                </div>
                
                <div id="github-tab" class="tab-content active">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">GitHub ì €ì¥ì†Œ URL</label>
                        <input type="text" id="github-url" placeholder="https://github.com/username/repository" 
                               style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                        <p style="margin-top: 10px; color: #666; font-size: 14px;">
                            ì˜ˆì‹œ: https://github.com/username/portfolio ë˜ëŠ” https://github.com/username/portfolio.git
                        </p>
                    </div>
                    <div id="github-status" style="display: none; padding: 15px; background: #f8f9ff; border-radius: 8px; margin-top: 15px;"></div>
                </div>
                
                <div id="text-tab" class="tab-content">
                    <textarea id="code-input" placeholder="ë¶„ì„í•  ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;def hello_world():&#10;    print('Hello, World!')&#10;    return True"></textarea>
                </div>
                
                <div id="file-tab" class="tab-content">
                    <div class="file-upload" onclick="document.getElementById('file-input').click()">
                        <input type="file" id="file-input" accept=".py,.js,.ts,.java,.cpp,.c,.cs,.go,.rs,.rb,.php" onchange="handleFileSelect(event)">
                        <div class="file-upload-label">ğŸ“ í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</div>
                        <div class="file-info" id="file-info">ë˜ëŠ” íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    </div>
                    <textarea id="file-content" style="display: none; margin-top: 20px;"></textarea>
                </div>
                
                <button class="analyze-btn" id="analyze-btn" onclick="handleAnalyze()">ë¶„ì„ ì‹œì‘</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ì½”ë“œë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
            </div>
            
            <div class="results" id="results"></div>
        </div>
        
        <div class="copyright">
            Copyright (c) 2025 Gaon. All rights reserved.<br>
            ì›ë³¸ ì¶œì²˜: <a href="https://github.com/annie-recruit/Portfolio-code-analyzer" style="color: #667eea;">https://github.com/annie-recruit/Portfolio-code-analyzer</a>
        </div>
    </div>

    <script>
        let pyodide = null;
        let currentCode = '';

        // Pyodide ì´ˆê¸°í™”
        async function initPyodide() {
            if (pyodide) return;
            
            console.log('Pyodide ì´ˆê¸°í™” ì¤‘...');
            pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
            });
            
            // í•„ìš”í•œ Python ëª¨ë“ˆ ì„¤ì¹˜
            await pyodide.loadPackage(['micropip']);
            const micropip = pyodide.pyimport('micropip');
            
            console.log('Pyodide ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // íƒ­ ì „í™˜
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            if (tab === 'github') {
                tabs[0].classList.add('active');
                document.getElementById('github-tab').classList.add('active');
            } else if (tab === 'text') {
                tabs[1].classList.add('active');
                document.getElementById('text-tab').classList.add('active');
            } else {
                tabs[2].classList.add('active');
                document.getElementById('file-tab').classList.add('active');
            }
        }

        // ë¶„ì„ ë²„íŠ¼ í•¸ë“¤ëŸ¬
        async function handleAnalyze() {
            const githubUrl = document.getElementById('github-url');
            if (githubUrl && githubUrl.value.trim()) {
                // GitHub ì €ì¥ì†Œì—ì„œ ê°€ì ¸ì˜¤ê¸°
                await fetchFromGitHub();
            } else {
                // ì¼ë°˜ ë¶„ì„
                analyzeCode();
            }
        }

        // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('file-info').textContent = `ì„ íƒëœ íŒŒì¼: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentCode = e.target.result;
                document.getElementById('file-content').value = currentCode;
            };
            reader.readAsText(file);
        }

        // GitHub ì €ì¥ì†Œì—ì„œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        async function fetchFromGitHub() {
            const githubUrl = document.getElementById('github-url').value.trim();
            if (!githubUrl) {
                alert('GitHub ì €ì¥ì†Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // URL íŒŒì‹±
            let repoPath = '';
            if (githubUrl.includes('github.com/')) {
                const match = githubUrl.match(/github\.com\/([^\/]+\/[^\/]+)/);
                if (match) {
                    repoPath = match[1].replace(/\.git$/, '');
                } else {
                    alert('ì˜¬ë°”ë¥¸ GitHub ì €ì¥ì†Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            } else {
                alert('ì˜¬ë°”ë¥¸ GitHub ì €ì¥ì†Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const statusDiv = document.getElementById('github-status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<p>ğŸ“¡ GitHub ì €ì¥ì†Œì—ì„œ ì½”ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>';
            
            try {
                // GitHub APIë¥¼ í†µí•´ ì €ì¥ì†Œì˜ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const apiUrl = `https://api.github.com/repos/${repoPath}/git/trees/main?recursive=1`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    // main ë¸Œëœì¹˜ê°€ ì—†ìœ¼ë©´ master ì‹œë„
                    const masterUrl = `https://api.github.com/repos/${repoPath}/git/trees/master?recursive=1`;
                    const masterResponse = await fetch(masterUrl);
                    if (!masterResponse.ok) {
                        throw new Error('ì €ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    const data = await masterResponse.json();
                    await processGitHubFiles(data.tree, repoPath);
                } else {
                    const data = await response.json();
                    await processGitHubFiles(data.tree, repoPath);
                }
            } catch (error) {
                statusDiv.innerHTML = `<p style="color: red;">âŒ ì˜¤ë¥˜: ${error.message}</p>`;
                console.error('GitHub API ì˜¤ë¥˜:', error);
            }
        }
        
        // GitHub íŒŒì¼ ì²˜ë¦¬
        async function processGitHubFiles(files, repoPath) {
            const statusDiv = document.getElementById('github-status');
            const codeExtensions = ['.py', '.js', '.ts', '.java', '.cpp', '.c', '.cs', '.go', '.rs', '.rb', '.php'];
            
            // ì½”ë“œ íŒŒì¼ë§Œ í•„í„°ë§
            const codeFiles = files.filter(file => {
                const path = file.path.toLowerCase();
                return codeExtensions.some(ext => path.endsWith(ext)) &&
                       !path.includes('node_modules') &&
                       !path.includes('venv') &&
                       !path.includes('.git') &&
                       file.type === 'blob';
            });
            
            if (codeFiles.length === 0) {
                statusDiv.innerHTML = '<p style="color: orange;">âš ï¸ ì½”ë“œ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            statusDiv.innerHTML = `<p>ğŸ“ ${codeFiles.length}ê°œì˜ ì½”ë“œ íŒŒì¼ ë°œê²¬. ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>`;
            
            // ìµœëŒ€ 50ê°œ íŒŒì¼ê¹Œì§€ ê°€ì ¸ì˜¤ê¸° (ë„ˆë¬´ ë§ìœ¼ë©´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼)
            const maxFiles = 50;
            const filesToFetch = codeFiles.slice(0, maxFiles);
            
            if (codeFiles.length > maxFiles) {
                statusDiv.innerHTML += `<p style="color: orange; margin-top: 10px;">âš ï¸ ì´ ${codeFiles.length}ê°œ íŒŒì¼ ì¤‘ ${maxFiles}ê°œë§Œ ë¶„ì„í•©ë‹ˆë‹¤. (ì„±ëŠ¥ìƒ ì œí•œ)</p>`;
            }
            let allCode = '';
            let fetchedCount = 0;
            
            // íŒŒì¼ë³„ ì •ë³´ ì €ì¥
            const fileData = [];
            
            for (const file of filesToFetch) {
                try {
                    const rawUrl = `https://raw.githubusercontent.com/${repoPath}/main/${file.path}`;
                    let response = await fetch(rawUrl);
                    
                    if (!response.ok) {
                        // mainì´ ì•„ë‹ˆë©´ master ì‹œë„
                        const masterUrl = `https://raw.githubusercontent.com/${repoPath}/master/${file.path}`;
                        response = await fetch(masterUrl);
                    }
                    
                    if (response.ok) {
                        const content = await response.text();
                        const ext = file.path.split('.').pop().toLowerCase();
                        fileData.push({
                            path: file.path,
                            content: content,
                            extension: ext
                        });
                        fetchedCount++;
                        statusDiv.innerHTML = `<p>ğŸ“¥ ${fetchedCount}/${filesToFetch.length} íŒŒì¼ ê°€ì ¸ì˜´...</p>`;
                    }
                } catch (error) {
                    console.error(`íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${file.path}`, error);
                }
            }
            
            if (fileData.length > 0) {
                // íŒŒì¼ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ì €ì¥í•˜ì—¬ ë¶„ì„ í•¨ìˆ˜ì— ì „ë‹¬
                window.githubFileData = fileData;
                window.githubTotalFiles = codeFiles.length; // ì „ì²´ íŒŒì¼ ìˆ˜ ì €ì¥
                currentCode = fileData.map(f => `# File: ${f.path}\n${f.content}`).join('\n\n');
                statusDiv.innerHTML = `<p style="color: green;">âœ… ${fetchedCount}ê°œ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ! ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...</p>`;
                // ìë™ìœ¼ë¡œ ë¶„ì„ ì‹œì‘
                setTimeout(() => {
                    analyzeCode();
                }, 500);
            } else {
                statusDiv.innerHTML = '<p style="color: red;">âŒ ì½”ë“œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ì½”ë“œ ë¶„ì„
        async function analyzeCode() {
            const codeInput = document.getElementById('code-input');
            const fileContent = document.getElementById('file-content');
            const githubUrl = document.getElementById('github-url');
            
            // ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
            if (githubUrl && githubUrl.value.trim() && currentCode) {
                // GitHubì—ì„œ ê°€ì ¸ì˜¨ ì½”ë“œ ì‚¬ìš©
            } else if (codeInput.value.trim()) {
                currentCode = codeInput.value;
            } else if (fileContent.value.trim()) {
                currentCode = fileContent.value;
            } else {
                alert('ì½”ë“œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ GitHub ì €ì¥ì†Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!currentCode.trim()) {
                alert('ì½”ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('analyze-btn').disabled = true;
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('results').innerHTML = '';
            
            try {
                // Pyodide ì´ˆê¸°í™” (ì²˜ìŒ í•œ ë²ˆë§Œ)
                await initPyodide();
                
                // íŒŒì¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const fileDataJson = JSON.stringify(window.githubFileData || []);
                const totalFiles = window.githubTotalFiles || 0;
                
                // Python ë¶„ì„ ì½”ë“œ ì‹¤í–‰
                const analysisCode = `
import ast
import re
import json
from collections import defaultdict

def analyze_code(code_content, file_data_json, total_files=0):
    results = {
        'files_analyzed': 0,
        'total_lines': 0,
        'total_files': total_files,
        'languages': defaultdict(int),
        'complexity': {'avg': 0, 'max': 0, 'high_complexity_files': []},
        'readability': {'score': 0, 'issues': []},
        'structure': {'score': 0, 'issues': []},
        'issues': [],
        'metrics': {}
    }
    
    # íŒŒì¼ ë°ì´í„° íŒŒì‹±
    file_data = json.loads(file_data_json) if file_data_json else []
    
    if not file_data:
        # ë‹¨ì¼ íŒŒì¼ì¸ ê²½ìš°
        lines = code_content.split('\\n')
        results['files_analyzed'] = 1
        results['total_lines'] = len(lines)
        
        # í™•ì¥ì ê¸°ë°˜ ì–¸ì–´ ê°ì§€
        lang = 'Unknown'
        if any(kw in code_content for kw in ['fn ', 'let ', 'mut ', 'use ', 'impl ', 'struct ', 'enum ']):
            lang = 'Rust'
            results['languages']['Rust'] = 1
        elif any(kw in code_content for kw in ['def ', 'import ', 'class ', 'print(']):
            lang = 'Python'
            results['languages']['Python'] = 1
        elif any(kw in code_content for kw in ['function ', 'const ', 'let ', '=>', 'export ']):
            lang = 'JavaScript'
            results['languages']['JavaScript'] = 1
        elif 'public class' in code_content or 'public static' in code_content:
            lang = 'Java'
            results['languages']['Java'] = 1
        else:
            results['languages']['Unknown'] = 1
    else:
        # ì—¬ëŸ¬ íŒŒì¼ ë¶„ì„
        total_complexity = 0
        complexity_count = 0
        
        for file_info in file_data:
            results['files_analyzed'] += 1
            file_path = file_info['path']
            file_content = file_info['content']
            file_ext = file_info.get('extension', '').lower()
            file_lines = file_content.split('\\n')
            results['total_lines'] += len(file_lines)
            
            # í™•ì¥ì ê¸°ë°˜ ì–¸ì–´ ê°ì§€
            if file_ext == 'rs':
                lang = 'Rust'
                results['languages']['Rust'] = results['languages'].get('Rust', 0) + 1
            elif file_ext == 'py':
                lang = 'Python'
                results['languages']['Python'] = results['languages'].get('Python', 0) + 1
            elif file_ext in ['js', 'jsx', 'ts', 'tsx']:
                lang = 'JavaScript'
                results['languages']['JavaScript'] = results['languages'].get('JavaScript', 0) + 1
            elif file_ext == 'java':
                lang = 'Java'
                results['languages']['Java'] = results['languages'].get('Java', 0) + 1
            else:
                lang = 'Unknown'
                results['languages'][file_ext.upper()] = results['languages'].get(file_ext.upper(), 0) + 1
    
            # ì–¸ì–´ë³„ ë³µì¡ë„ ê³„ì‚°
            complexity = 1
            if lang == 'Python':
                try:
                    tree = ast.parse(file_content)
                    for node in ast.walk(tree):
                        if isinstance(node, (ast.If, ast.While, ast.For, ast.Try, ast.With)):
                            complexity += 1
                        elif isinstance(node, ast.BoolOp):
                            complexity += len(node.values) - 1
                except:
                    complexity = 1
            elif lang == 'Rust':
                # Rust ë³µì¡ë„: if, while, for, match, loop ë“±
                complexity += len(re.findall(r'\\bif\\b|\\bwhile\\b|\\bfor\\b|\\bmatch\\b|\\bloop\\b', file_content))
                complexity += len(re.findall(r'&&|\\|\\|', file_content))
            elif lang == 'JavaScript':
                complexity += len(re.findall(r'\\bif\\b|\\bwhile\\b|\\bfor\\b|\\bswitch\\b', file_content))
                complexity += len(re.findall(r'&&|\\|\\|', file_content))
            elif lang == 'Java':
                complexity += len(re.findall(r'\\bif\\b|\\bwhile\\b|\\bfor\\b|\\bswitch\\b', file_content))
                complexity += len(re.findall(r'&&|\\|\\|', file_content))
            
            total_complexity += complexity
            complexity_count += 1
            
            if complexity > results['complexity']['max']:
                results['complexity']['max'] = complexity
            
            if complexity > 10:
                results['complexity']['high_complexity_files'].append({
                    'file': file_path,
                    'complexity': complexity
                })
            
            # íŒŒì¼ë³„ ê°€ë…ì„± ì²´í¬
            comment_lines = sum(1 for line in file_lines if line.strip().startswith('#') or 
                              line.strip().startswith('//') or '/*' in line or line.strip().startswith('///'))
            comment_ratio = comment_lines / len(file_lines) if file_lines else 0
            
            if comment_ratio < 0.1 and len(file_lines) > 50:
                results['readability']['issues'].append({
                    'file': file_path,
                    'type': 'low_comments',
                    'message': 'ì£¼ì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤',
                    'severity': 'medium'
                })
            
            long_lines = [i+1 for i, line in enumerate(file_lines) if len(line) > 120]
            if long_lines:
                results['readability']['issues'].append({
                    'file': file_path,
                    'type': 'long_lines',
                    'message': f'120ìë¥¼ ì´ˆê³¼í•˜ëŠ” ê¸´ ì¤„ì´ {len(long_lines)}ê°œ ìˆìŠµë‹ˆë‹¤',
                    'severity': 'low'
                })
        
        # í‰ê·  ë³µì¡ë„ ê³„ì‚°
        if complexity_count > 0:
            results['complexity']['avg'] = total_complexity / complexity_count
        else:
            results['complexity']['avg'] = 0
    
    # ë‹¨ì¼ íŒŒì¼ì¸ ê²½ìš° ê°€ë…ì„± ì²´í¬
    if not file_data:
        comment_lines = sum(1 for line in lines if line.strip().startswith('#') or 
                          line.strip().startswith('//') or '/*' in line or line.strip().startswith('///'))
        comment_ratio = comment_lines / len(lines) if lines else 0
        
        if comment_ratio < 0.1 and len(lines) > 50:
            results['readability']['issues'].append({
                'file': 'uploaded_code',
                'type': 'low_comments',
                'message': 'ì£¼ì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤',
                'severity': 'medium'
            })
        
        long_lines = [i+1 for i, line in enumerate(lines) if len(line) > 120]
        if long_lines:
            results['readability']['issues'].append({
                'file': 'uploaded_code',
                'type': 'long_lines',
                'message': f'120ìë¥¼ ì´ˆê³¼í•˜ëŠ” ê¸´ ì¤„ì´ {len(long_lines)}ê°œ ìˆìŠµë‹ˆë‹¤',
                'severity': 'low'
            })
    
    # ì¢…í•© ì ìˆ˜ ê³„ì‚°
    score = 100
    if results['complexity']['avg'] > 10:
        score -= 20
    elif results['complexity']['avg'] > 5:
        score -= 10
    
    high_severity = sum(1 for issue in results['issues'] if issue.get('severity') == 'high')
    medium_severity = sum(1 for issue in results['issues'] if issue.get('severity') == 'medium')
    
    score -= high_severity * 5
    score -= medium_severity * 2
    score -= len(results['readability']['issues']) * 1
    score -= len(results['structure']['issues']) * 2
    
    score = max(0, min(100, score))
    results['overall_score'] = round(score, 1)
    
    if score >= 90:
        results['grade'] = 'A'
    elif score >= 80:
        results['grade'] = 'B'
    elif score >= 70:
        results['grade'] = 'C'
    elif score >= 60:
        results['grade'] = 'D'
    else:
        results['grade'] = 'F'
    
    return results

file_data_json = r'''${fileDataJson}'''
code_content = r'''${currentCode.replace(/'/g, "\\'")}'''
total_files = ${totalFiles}
result = analyze_code(code_content, file_data_json, total_files)
import json
json.dumps(result)
`;
                
                const resultJson = pyodide.runPython(analysisCode);
                const result = JSON.parse(resultJson);
                
                // ê²°ê³¼ í‘œì‹œ
                displayResults(result);
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        <strong>ì˜¤ë¥˜ ë°œìƒ:</strong><br>
                        ${error.message}<br>
                        <small>ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</small>
                    </div>
                `;
                document.getElementById('results').classList.add('active');
            } finally {
                document.getElementById('analyze-btn').disabled = false;
                document.getElementById('loading').classList.remove('active');
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(result) {
            const allIssues = [
                ...result.issues,
                ...result.readability.issues,
                ...result.structure.issues
            ];
            
            const highCount = allIssues.filter(i => i.severity === 'high').length;
            const mediumCount = allIssues.filter(i => i.severity === 'medium').length;
            const lowCount = allIssues.filter(i => i.severity === 'low').length;
            
            let languagesHtml = '';
            for (const [lang, count] of Object.entries(result.languages)) {
                languagesHtml += `<span style="background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; margin: 5px; display: inline-block;">${lang}</span>`;
            }
            
            let issuesHtml = '';
            if (allIssues.length === 0) {
                issuesHtml = '<p style="color: green;">âœ… ë°œê²¬ëœ ì´ìŠˆê°€ ì—†ìŠµë‹ˆë‹¤!</p>';
            } else {
                allIssues.forEach(issue => {
                    const severityColor = issue.severity === 'high' ? '#e74c3c' : 
                                        issue.severity === 'medium' ? '#f39c12' : '#3498db';
                    issuesHtml += `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid ${severityColor}; border-radius: 5px;">
                            <strong style="color: ${severityColor};">[${issue.severity.toUpperCase()}]</strong> ${issue.message}
                        </div>
                    `;
                });
            }
            
            const recommendations = [];
            if (result.overall_score < 70) {
                recommendations.push('ì½”ë“œ í’ˆì§ˆ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤');
            }
            if (result.complexity.avg > 10) {
                recommendations.push('ì½”ë“œ ë³µì¡ë„ë¥¼ ë‚®ì¶”ì„¸ìš”');
            }
            if (highCount > 0) {
                recommendations.push(`ì‹¬ê°í•œ ì´ìŠˆ ${highCount}ê°œë¥¼ ìš°ì„  í•´ê²°í•˜ì„¸ìš”`);
            }
            if (recommendations.length === 0) {
                recommendations.push('ì „ë°˜ì ìœ¼ë¡œ ì–‘í˜¸í•œ ì½”ë“œ í’ˆì§ˆì…ë‹ˆë‹¤');
            }
            
            const html = `
                <div class="score-display">
                    <div class="score">${result.overall_score}ì </div>
                    <div class="grade">ë“±ê¸‰: ${result.grade}</div>
                </div>
                
                <div class="result-card">
                    <h3>ğŸ“Š ë¶„ì„ ìš”ì•½</h3>
                    <p><strong>ë¶„ì„ëœ íŒŒì¼:</strong> ${result.files_analyzed}ê°œ${result.total_files ? ` (ì „ì²´ ${result.total_files}ê°œ ì¤‘)` : ''}</p>
                    <p><strong>ì´ ì½”ë“œ ë¼ì¸:</strong> ${result.total_lines.toLocaleString()}ì¤„</p>
                    <p><strong>íŒŒì¼ë‹¹ í‰ê·  ë¼ì¸:</strong> ${Math.round(result.total_lines / result.files_analyzed)}ì¤„</p>
                    <p><strong>í‰ê·  ë³µì¡ë„:</strong> ${result.complexity.avg.toFixed(1)} ${result.complexity.avg < 3 ? 'âœ… (ë‚®ìŒ)' : result.complexity.avg < 7 ? 'âš ï¸ (ë³´í†µ)' : 'âŒ (ë†’ìŒ)'}</p>
                    <div style="margin-top: 15px;">
                        <strong>ì‚¬ìš©ëœ ì–¸ì–´:</strong><br>
                        ${languagesHtml}
                    </div>
                </div>
                
                <div class="result-card">
                    <h3>âš ï¸ ë°œê²¬ëœ ì´ìŠˆ</h3>
                    <p><strong>ì‹¬ê°:</strong> ${highCount}ê°œ | <strong>ì¤‘ê°„:</strong> ${mediumCount}ê°œ | <strong>ë‚®ìŒ:</strong> ${lowCount}ê°œ</p>
                    ${issuesHtml}
                </div>
                
                <div class="result-card">
                    <h3>ğŸ’¡ ê°œì„  ê¶Œì¥ ì‚¬í•­</h3>
                    <ul>
                        ${recommendations.map(r => `<li>${r}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
            document.getElementById('results').classList.add('active');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Pyodide ì´ˆê¸°í™” ì‹œì‘
        window.addEventListener('load', () => {
            initPyodide();
        });
    </script>
</body>
</html>

